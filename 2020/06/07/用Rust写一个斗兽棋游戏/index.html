<!DOCTYPE html>


  <html class="light page-post">


<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="utf-8">
  
  <title>ç”¨ Rust å†™ä¸€ä¸ªæ–—å…½æ£‹æ¸¸æˆ | Netcan on Programming</title>

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
    <meta name="keywords" content="Rust," />
  

  <meta name="description" content="é¡¹ç›®åœ°å€ï¼š  Github: https:&#x2F;&#x2F;github.com&#x2F;netcan&#x2F;AnimalChess Crate.io: https:&#x2F;&#x2F;crates.io&#x2F;crates&#x2F;animal_chess lib.rs: https:&#x2F;&#x2F;lib.rs&#x2F;crates&#x2F;animal_chess  å¥½ä¹…æ²¡æ›´æ–° blog äº†ï¼Œä¸»è¦æŠ€æœ¯æ–‡ç« éƒ½æ˜¯åœ¨å…¬å¸å†…éƒ¨å†™ï¼Œåé¢çœ‹çœ‹æœ‰æ²¡æœ‰æœºä¼šåŒæ­¥åˆ° blog ä¸Šã€‚ ç°åœ¨åˆ©ç”¨ä¸šä½™">
<meta property="og:type" content="article">
<meta property="og:title" content="ç”¨ Rust å†™ä¸€ä¸ªæ–—å…½æ£‹æ¸¸æˆ">
<meta property="og:url" content="https://netcan.github.io/2020/06/07/%E7%94%A8Rust%E5%86%99%E4%B8%80%E4%B8%AA%E6%96%97%E5%85%BD%E6%A3%8B%E6%B8%B8%E6%88%8F/index.html">
<meta property="og:site_name" content="Netcan on Programming">
<meta property="og:description" content="é¡¹ç›®åœ°å€ï¼š  Github: https:&#x2F;&#x2F;github.com&#x2F;netcan&#x2F;AnimalChess Crate.io: https:&#x2F;&#x2F;crates.io&#x2F;crates&#x2F;animal_chess lib.rs: https:&#x2F;&#x2F;lib.rs&#x2F;crates&#x2F;animal_chess  å¥½ä¹…æ²¡æ›´æ–° blog äº†ï¼Œä¸»è¦æŠ€æœ¯æ–‡ç« éƒ½æ˜¯åœ¨å…¬å¸å†…éƒ¨å†™ï¼Œåé¢çœ‹çœ‹æœ‰æ²¡æœ‰æœºä¼šåŒæ­¥åˆ° blog ä¸Šã€‚ ç°åœ¨åˆ©ç”¨ä¸šä½™">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://netcan.github.io/2020/06/07/%E7%94%A8Rust%E5%86%99%E4%B8%80%E4%B8%AA%E6%96%97%E5%85%BD%E6%A3%8B%E6%B8%B8%E6%88%8F/ChineseChess.png">
<meta property="og:image" content="https://netcan.github.io/2020/06/07/%E7%94%A8Rust%E5%86%99%E4%B8%80%E4%B8%AA%E6%96%97%E5%85%BD%E6%A3%8B%E6%B8%B8%E6%88%8F/animal_chess.png">
<meta property="article:published_time" content="2020-06-07T02:56:49.000Z">
<meta property="article:modified_time" content="2022-12-09T11:02:08.601Z">
<meta property="article:author" content="Netcan">
<meta property="article:tag" content="Rust">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://netcan.github.io/2020/06/07/%E7%94%A8Rust%E5%86%99%E4%B8%80%E4%B8%AA%E6%96%97%E5%85%BD%E6%A3%8B%E6%B8%B8%E6%88%8F/ChineseChess.png">

  

  
    <link rel="icon" href="/favicon.ico">
  

  <link href="/css/styles.css?v=c114cbeddx" rel="stylesheet">


  
    
<link rel="stylesheet" href="/css/site.css">

  

  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-174901164-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


  
  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?d2c292719a76d8c0fa7f9874379cfd25";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>


  
  <script type="text/javascript">
	(function(){
	    var bp = document.createElement('script');
	    var curProtocol = window.location.protocol.split(':')[0];
	    if (curProtocol === 'https') {
	        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
	    }
	    else {
	        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
	    }
	    var s = document.getElementsByTagName("script")[0];
	    s.parentNode.insertBefore(bp, s);
	})();
  </script>



  
    <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.3.0/css/font-awesome.min.css">
  

<meta name="generator" content="Hexo 5.0.0"><style>mjx-container[jax="SVG"] {
  direction: ltr;
}

mjx-container[jax="SVG"] > svg {
  overflow: visible;
}

mjx-container[jax="SVG"] > svg a {
  fill: blue;
  stroke: blue;
}

mjx-container[jax="SVG"][display="true"] {
  display: block;
  text-align: center;
  margin: 1em 0;
}

mjx-container[jax="SVG"][justify="left"] {
  text-align: left;
}

mjx-container[jax="SVG"][justify="right"] {
  text-align: right;
}

g[data-mml-node="merror"] > g {
  fill: red;
  stroke: red;
}

g[data-mml-node="merror"] > rect[data-background] {
  fill: yellow;
  stroke: none;
}

g[data-mml-node="mtable"] > line[data-line] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > rect[data-frame] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > .mjx-dashed {
  stroke-dasharray: 140;
}

g[data-mml-node="mtable"] > .mjx-dotted {
  stroke-linecap: round;
  stroke-dasharray: 0,140;
}

g[data-mml-node="mtable"] > svg {
  overflow: visible;
}

[jax="SVG"] mjx-tool {
  display: inline-block;
  position: relative;
  width: 0;
  height: 0;
}

[jax="SVG"] mjx-tool > mjx-tip {
  position: absolute;
  top: 0;
  left: 0;
}

mjx-tool > mjx-tip {
  display: inline-block;
  padding: .2em;
  border: 1px solid #888;
  font-size: 70%;
  background-color: #F8F8F8;
  color: black;
  box-shadow: 2px 2px 5px #AAAAAA;
}

g[data-mml-node="maction"][data-toggle] {
  cursor: pointer;
}

mjx-status {
  display: block;
  position: fixed;
  left: 1em;
  bottom: 1em;
  min-width: 25%;
  padding: .2em .4em;
  border: 1px solid #888;
  font-size: 90%;
  background-color: #F8F8F8;
  color: black;
}

foreignObject[data-mjx-xml] {
  font-family: initial;
  line-height: normal;
  overflow: visible;
}

.MathJax path {
  stroke-width: 3;
}

mjx-container[display="true"] {
  overflow: auto hidden;
}

mjx-container[display="true"] + br {
  display: none;
}
</style><link rel="alternate" href="/atom.xml" title="Netcan on Programming" type="application/atom+xml"><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</head>

<body>


  
    <!-- hexo-inject:begin --><!-- hexo-inject:end --><span id="toolbox-mobile" class="toolbox-mobile">ROOT</span>
  

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@4.0/dist/fancybox.css"/>
<link rel="stylesheet" href="/css/prism.css">

<div class="post-header CENTER">
   
  <div class="toolbox">
    <a class="toolbox-entry" href="/">
      <span class="toolbox-entry-text">ROOT</span>
      <i class="icon-angle-down"></i>
      <i class="icon-home"></i>
    </a>
    <ul class="list-toolbox">
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/archives/"
            rel="noopener noreferrer"
            target="_self"
            >
            åšå®¢
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/category/"
            rel="noopener noreferrer"
            target="_self"
            >
            åˆ†ç±»
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/tag/"
            rel="noopener noreferrer"
            target="_self"
            >
            æ ‡ç­¾
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/about/"
            rel="noopener noreferrer"
            target="_self"
            >
            å…³äº
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/atom.xml"
            rel="noopener noreferrer"
            target="_blank"
            >
            RSS
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/search/"
            rel="noopener noreferrer"
            target="_self"
            >
            æœç´¢
          </a>
        </li>
      
    </ul>
  </div>


</div>


  <div id="toc" class="toc-article">
    <strong class="toc-title">æ–‡ç« ç›®å½•</strong>
    <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A8%A1%E5%9D%97%E5%88%92%E5%88%86"><span class="toc-text">æ¨¡å—åˆ’åˆ†</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8C%85%E7%AE%A1%E7%90%86"><span class="toc-text">åŒ…ç®¡ç†</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B1%BB%E5%9E%8B%E5%88%AB%E5%90%8D"><span class="toc-text">ç±»å‹åˆ«å</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86"><span class="toc-text">å¼‚å¸¸å¤„ç†</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%93%E6%9E%84%E4%BD%93%E5%AE%9A%E4%B9%89"><span class="toc-text">ç»“æ„ä½“å®šä¹‰</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#if-let%20%E8%A1%A8%E8%BE%BE%E5%BC%8F%EF%BC%8C%E7%BB%93%E6%9E%84%E5%8C%96%E7%BB%91%E5%AE%9A"><span class="toc-text">if-letè¡¨è¾¾å¼ï¼Œç»“æ„åŒ–ç»‘å®š</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#match%20%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="toc-text">match è¡¨è¾¾å¼</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#lambda%20%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="toc-text">lambda è¡¨è¾¾å¼</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%AD%E4%BB%A3%E5%99%A8"><span class="toc-text">è¿­ä»£å™¨</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Borrow-Checker"><span class="toc-text">Borrow Checker</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%8F"><span class="toc-text">å®</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Trait"><span class="toc-text">Trait</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95"><span class="toc-text">æµ‹è¯•</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%90%E6%A7%BD"><span class="toc-text">åæ§½</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%8E%E7%BB%AD"><span class="toc-text">åç»­</span></a></li></ol>
  </div>



<div class="content content-post CENTER">
   <article id="post-ç”¨Rustå†™ä¸€ä¸ªæ–—å…½æ£‹æ¸¸æˆ" class="article article-type-post" itemprop="blogPost">
  <header class="article-header">
    <h1 class="post-title">ç”¨ Rust å†™ä¸€ä¸ªæ–—å…½æ£‹æ¸¸æˆ</h1>

    <div class="article-meta">
      <span>
        <i class="icon-calendar"></i>
        <span>2020.06.07</span>
      </span>

      
        <span class="article-author">
          <i class="icon-user"></i>
          <span>Netcan</span>
        </span>
      

      
  <span class="article-category">
    <i class="icon-list"></i>
    <a class="article-category-link" href="/categories/%E7%BC%96%E7%A8%8B/">ç¼–ç¨‹</a>
  </span>



      

      
      <i class="fa fa-eye"></i> 
        <span id="busuanzi_container_page_pv">
           &nbspçƒ­åº¦ <span id="busuanzi_value_page_pv">
           <i class="fa fa-spinner fa-spin"></i></span>â„ƒ
        </span>
      
      
    </div>
  </header>

  <div class="article-content">
    
      <p>é¡¹ç›®åœ°å€ï¼š</p>
<ul>
<li>Github: <a target="_blank" rel="noopener" href="https://github.com/netcan/AnimalChess">https://github.com/netcan/AnimalChess</a></li>
<li>Crate.io: <a target="_blank" rel="noopener" href="https://crates.io/crates/animal_chess">https://crates.io/crates/animal_chess</a></li>
<li>lib.rs: <a target="_blank" rel="noopener" href="https://lib.rs/crates/animal_chess">https://lib.rs/crates/animal_chess</a></li>
</ul>
<p>å¥½ä¹…æ²¡æ›´æ–° blog äº†ï¼Œä¸»è¦æŠ€æœ¯æ–‡ç« éƒ½æ˜¯åœ¨å…¬å¸å†…éƒ¨å†™ï¼Œåé¢çœ‹çœ‹æœ‰æ²¡æœ‰æœºä¼šåŒæ­¥åˆ° blog ä¸Šã€‚</p>
<p>ç°åœ¨åˆ©ç”¨ä¸šä½™æ—¶é—´å†™äº†æ£‹ç±»æ¸¸æˆï¼Œèµ·åˆæ˜¯å› ä¸ºéƒ¨é—¨æœ€è¿‘ä¸¾è¡Œç¼–ç¨‹å¤§èµ›ï¼Œä¸»é¢˜æ˜¯å†™ä¸€ä¸ªä¸­å›½è±¡æ£‹ AIï¼Œè¿™æœŸé—´å·å·å‚åŠ äº†æ¯”èµ›ï¼Œå‚è€ƒäº†å›½é™…ã€ä¸­å›½è±¡æ£‹çš„ç›¸å…³ç®—æ³•ï¼Œæœ€ååˆ©ç”¨ Alpha-Beta å‰ªæç®—æ³•ï¼Œå–å¾—äº†æ€»å†³èµ›å­£å†›åæ¬¡ï¼Œè¿™ä¸ªåæ¬¡å¯¹æˆ‘ä»¬æ¥è¯´è¿˜å¯ä»¥ï¼Œå› ä¸ºå…«å¼ºä¸­æœ‰ä¸ƒå¼ºæ˜¯ç›´æ¥æ‹¿å¼€æºä»£ç ç¨å¾®æ”¹æ”¹å°±æ¯”èµ›äº†çš„ï¼Œæˆ‘ä»¬å…¨é è‡ªå·±å†™ï¼Œæ‹¿åˆ°è¿™ä¸ªåæ¬¡è¿˜ç®—å¯ä»¥ã€‚</p>
<p>è¿˜æ˜¯è¦åæ§½è¿™æ¬¡æ¯”èµ›çš„ï¼Œæ¯•ç«Ÿéƒ¨é—¨æ˜¯ç¬¬ä¸€æ¬¡ä¸¾åŠè½¯ä»¶å¤§èµ›ï¼Œé€‰äº†è¿™ç§ç½‘ä¸Šä»£ç ä¸€å¤§å †çš„é¢˜ç›®å®åœ¨æ²¡æ„æ€ã€‚è¿˜æ˜¯æ— çº¿çš„è½¯ä»¶å¤§èµ›æœ‰æ„æ€ï¼Œé¢˜ç›®æ¯”è¾ƒåé—¨ï¼Œæ¯”å¦‚ 18 å¹´é‚£æ¬¡æ¯”èµ›æ˜¯å†™ä¸€ä¸ª RTS å¯¹æŠ—æ¸¸æˆçš„ aiï¼Œç½‘ä¸Šæ²¡æœ‰ç°æˆçš„ä»£ç å¯åˆ©ç”¨ï¼Œå…¨é æ‰‹å†™ï¼Œå°±è¿™æ ·æ‹¿äº†å† å†›ã€‚</p>
<p>ç¼–ç æ˜¯æˆ‘çš„çˆ±å¥½ï¼Œä¸šä½™æ—¶é—´æƒ³å†™ç‚¹ä»€ä¹ˆæ¥æ¶ˆé£ä¸€ä¸‹ï¼Œæ­£å¥½æœ€è¿‘è¿™ä¸ªè±¡æ£‹æ¸¸æˆç»™äº†æˆ‘å¯å‘ï¼Œä¸å¦‚ç›´æ¥ä¹Ÿä»å¤´å†™ä¸€ä¸ªç©ç©ï¼Œæ—¢ç„¶å†™å°±éœ€è¦è€ƒè™‘ç”¨ä»€ä¹ˆè¯­è¨€å†™äº†ï¼Œ<code>C/C++</code>æ˜¯æˆ‘çš„å¼ºé¡¹ï¼Œå†™äº†å¯¹æˆ‘æ¥è¯´æ²¡ä»»ä½•ç¼–ç æŠ€å·§ä¸Šçš„æå‡ï¼Œå°±ç”¨ <code>Rust</code> æ¥è¯•è¯•æ‰‹ï¼Œçœ‹çœ‹ <strong> ç¼–ç ä½“éªŒ </strong> å¦‚ä½•å§ï¼Œäºæ˜¯æœ‰äº†ä¸‹é¢çš„é¡¹ç›®ï¼š</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/netcan/ChineseChess">https://github.com/netcan/ChineseChess</a></li>
</ul>
<p>æŠŠ GUI å†™å®Œåï¼Œå‘ç°åœ¨å†™ä¸‹å»æ²¡æ„æ€ï¼Œå› ä¸ºåœ¨æ¯”èµ›çš„æ—¶å€™å·²ç»ç”¨ <code>C++</code> æŠŠ AI å†™è¿‡ä¸€ç¼–ï¼Œäºæ˜¯å°±å…ˆæç½®äº†ã€‚</p>
<p><img src="ChineseChess.png" alt="ChineseChess.png"></p>
<p>åæ¥æƒ³èµ·äº†å°å­¦çˆ±ç©çš„æ–—å…½æ£‹ï¼Œå¿ƒè¡€æ¥æ½®ï¼Œè§„åˆ™æ¯”è¾ƒç®€å•ï¼Œåˆ†æ”¯å› å­ä¹Ÿå°ï¼Œç›¸å¯¹è±¡æ£‹æ¥è¯´ç®€å•å¤šäº†ï¼Œç„¶åå°±æ”¶é›†ç´ æï¼Œå¾ˆå¿«æŠŠè±¡æ£‹çš„ GUI æ”¹æˆäº†æ–—å…½æ£‹çš„ï¼Œå¹¶æ·»åŠ äº† AIã€‚è™½ç„¶ç›®å‰çš„ AI æ¯”è¾ƒå¼±æ™ºï¼Œä½†æ˜¯æˆ‘ç›®å‰å·²ç»å¾ˆéš¾èµ¢äº†ğŸ˜‚ã€‚</p>
<p><img src="animal_chess.png" alt="animal_chess.png"></p>
<h2 id="æ¨¡å—åˆ’åˆ†">æ¨¡å—åˆ’åˆ†</h2>
<p>æ¥ä¸‹æ¥è®²è®²å®ç°éƒ¨åˆ†ã€‚ç›®å‰é¡¹ç›®ç”±å››éƒ¨åˆ†å®ç°ï¼š</p>
<pre class="language-none"><code class="language-none">src
â”œâ”€â”€ ai.rs    # AI å®ç°
â”œâ”€â”€ chess.rs # æ£‹å­çš„å®šä¹‰
â”œâ”€â”€ game.rs  # æ ¸å¿ƒæ¡†æ¶ã€å›¾åƒæ¸²æŸ“
â””â”€â”€ main.rs  # ç¨‹åºä¸»å…¥å£</code></pre>
<p>é¦–å…ˆéœ€è¦ GUI æ¥äº¤äº’ï¼Œæˆ‘è€ƒè™‘äº† <code>SDL</code> æ¡†æ¶ï¼Œå› ä¸ºä¸Šæ‰‹ç®€å•ï¼Œå¾ˆå¿«ä»¿ç€ <code>rust-sdl2</code> ä¾‹å­å†™äº†ä¸ª gui å‡ºæ¥ï¼š<a target="_blank" rel="noopener" href="https://docs.rs/sdl2/0.34.0/sdl2/#getting-started">https://docs.rs/sdl2/0.34.0/sdl2/#getting-started</a>ã€‚</p>
<h2 id="åŒ…ç®¡ç†">åŒ…ç®¡ç†</h2>
<p>ç°ä»£è¯­è¨€çš„åŒ…ç®¡ç†éƒ½åšçš„ä¸é”™ï¼ŒRust ä¹Ÿä¸ä¾‹å¤–ï¼Œè¿™é‡Œæˆ‘éœ€è¦ SDL åº“çš„æ”¯æŒï¼Œåœ¨ <code>Cargo.toml</code> æ–‡ä»¶ä¸­åŠ ä¸Šè¿™ä¹ˆå‡ å¥ï¼š</p>
<pre class="language-toml" data-language="toml"><code class="language-toml"><span class="token punctuation">[</span><span class="token table class-name">dependencies.sdl2</span><span class="token punctuation">]</span>
<span class="token key property">version</span> <span class="token punctuation">=</span> <span class="token string">"0.34.1"</span>
<span class="token key property">default-features</span> <span class="token punctuation">=</span> <span class="token boolean">false</span>
<span class="token key property">features</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">"image"</span><span class="token punctuation">,</span> <span class="token string">"unsafe_textures"</span><span class="token punctuation">]</span></code></pre>
<p>æ„å»ºç¨‹åºçš„æ—¶å€™è‡ªåŠ¨ä¸‹è½½ä¾èµ–åŒ…è¿›è¡Œç¼–è¯‘ã€‚</p>
<h2 id="ç±»å‹åˆ«å">ç±»å‹åˆ«å</h2>
<p>å’Œ C çš„ <code>typedef</code>ï¼ŒC++ çš„<code>using</code> ç±»ä¼¼ï¼ŒRust ä¹Ÿæ”¯æŒåˆ«åï¼š</p>
<pre class="language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">pub</span> <span class="token keyword">type</span> <span class="token constant">POS</span> <span class="token operator">=</span> <span class="token keyword">u8</span><span class="token punctuation">;</span>
<span class="token keyword">pub</span> <span class="token keyword">type</span> <span class="token constant">MOVE</span> <span class="token operator">=</span> <span class="token keyword">u16</span><span class="token punctuation">;</span>
<span class="token keyword">pub</span> <span class="token keyword">type</span> <span class="token class-name">ScoreType</span> <span class="token operator">=</span> <span class="token keyword">i32</span><span class="token punctuation">;</span></code></pre>
<h2 id="å¼‚å¸¸å¤„ç†">å¼‚å¸¸å¤„ç†</h2>
<p>æ¥çœ‹çœ‹å¼‚å¸¸å¤„ç†ï¼ŒRust æœ‰ä¸ªè¯­æ³•ç³– <code>?</code> å¯ä»¥å¾ˆç®€å•çš„å¤„ç†å¼‚å¸¸ã€‚è€Œé€šå¸¸ <code>Result</code> ç±»å‹èƒ½å¤Ÿå¾ˆå¥½ä»£æ›¿ä¼ ç»Ÿçš„é”™è¯¯ç å¤„ç†æ–¹å¼ï¼Œæ¯•ç«Ÿ <code>Result</code> æ˜¯å¯ä»¥é€šè¿‡ <code>and_then</code> ç»„åˆå­ä¸²è”ç»„åˆé”™è¯¯å¤„ç†è¿‡ç¨‹ã€‚</p>
<pre class="language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">let</span> sdl_ctx <span class="token operator">=</span> <span class="token namespace">sdl2<span class="token punctuation">::</span></span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> video_sys <span class="token operator">=</span> sdl_ctx<span class="token punctuation">.</span><span class="token function">video</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> windows <span class="token operator">=</span> video_sys<span class="token punctuation">.</span><span class="token function">window</span><span class="token punctuation">(</span><span class="token string">"AnimalChess"</span><span class="token punctuation">,</span> <span class="token constant">WINDOW_WIDTH</span><span class="token punctuation">,</span> <span class="token constant">WINDOW_HEIGHT</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">position_centered</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment">// .resizable()</span>
        <span class="token punctuation">.</span><span class="token function">allow_highdpi</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">expect</span><span class="token punctuation">(</span><span class="token string">"could not initialize video subsystem"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> <span class="token keyword">mut</span> game <span class="token operator">=</span> <span class="token class-name">Game</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span>windows<span class="token punctuation">,</span> sdl_ctx<span class="token punctuation">.</span><span class="token function">event_pump</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    game<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span></code></pre>
<p>å…¶ä¸­ <code>sdl2::init()?</code> è¡¨è¾¾äº† <code>init</code> å¯èƒ½å¤±è´¥å¯¼è‡´ <code>panic</code>ï¼Œæˆ‘ä¹Ÿä¸å¤„ç†è¿™ä¸ªå¼‚å¸¸ï¼Œç›´æ¥é€šè¿‡<code>?</code> æ‰”å‡ºå»ã€‚</p>
<h2 id="ç»“æ„ä½“å®šä¹‰">ç»“æ„ä½“å®šä¹‰</h2>
<p>ç„¶åæŠŠ GUI éƒ¨åˆ†ä» <code>main</code> æå–å‡ºæ¥ï¼Œå°è£…åˆ° <code>Game</code> ç±»ä¸­ï¼š</p>
<pre class="language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">Game</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">pub</span> chesses<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token class-name">ChessId</span><span class="token punctuation">;</span> <span class="token constant">COL_NUM</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token constant">ROW_NUM</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    chesses_textures<span class="token punctuation">:</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">Texture</span><span class="token operator">></span><span class="token punctuation">,</span>
    <span class="token keyword">pub</span> role<span class="token punctuation">:</span> <span class="token class-name">Role</span><span class="token punctuation">,</span> <span class="token comment">// è½®åˆ°è°ä¸‹</span>
    board<span class="token punctuation">:</span> <span class="token class-name">Texture</span><span class="token punctuation">,</span>
    canvas<span class="token punctuation">:</span> <span class="token class-name">WindowCanvas</span><span class="token punctuation">,</span>
    event_pump<span class="token punctuation">:</span> <span class="token class-name">EventPump</span><span class="token punctuation">,</span>
    selected_chess<span class="token punctuation">:</span> <span class="token class-name">Option</span><span class="token operator">&lt;</span><span class="token constant">POS</span><span class="token operator">></span><span class="token punctuation">,</span>
    selected_frame<span class="token punctuation">:</span> <span class="token class-name">Texture</span><span class="token punctuation">,</span>
    movable_pos<span class="token punctuation">:</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token constant">MOVE</span><span class="token operator">></span><span class="token punctuation">,</span>
    <span class="token keyword">pub</span> compture_turn<span class="token punctuation">:</span> <span class="token keyword">bool</span><span class="token punctuation">,</span>
    <span class="token keyword">pub</span> compture_mv<span class="token punctuation">:</span> <span class="token class-name">Option</span><span class="token operator">&lt;</span><span class="token constant">MOVE</span><span class="token operator">></span><span class="token punctuation">,</span>
    ctx<span class="token punctuation">:</span> <span class="token class-name">VecDeque</span><span class="token operator">&lt;</span><span class="token class-name">Context</span><span class="token operator">></span><span class="token punctuation">,</span>
    <span class="token keyword">pub</span> history_table<span class="token punctuation">:</span> <span class="token class-name">HisTblType</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span></code></pre>
<h2 id="if-let è¡¨è¾¾å¼ï¼Œç»“æ„åŒ–ç»‘å®š"><code>if-let</code>è¡¨è¾¾å¼ï¼Œç»“æ„åŒ–ç»‘å®š</h2>
<p>å…¶ä¸­æ£‹å­ã€æ£‹ç›˜çš„ç´ æå­˜åˆ°äº† <code>chesses_textures</code>, <code>board</code> æˆå‘˜ä¸­ï¼Œå¹¶ç”¨ <code>chesses</code> å­˜æ”¾äº†æ£‹ç›˜å†…å®¹ã€‚<code>selected_chess</code>å­˜çš„æ˜¯å½“å‰ç”¨æˆ·ç‚¹å‡»çš„æ£‹å­ï¼Œ<code>movable_pos</code>å­˜æ”¾çš„æ˜¯å½“å‰é€‰ä¸­æ£‹å­å¯èµ°çš„æ ¼å­ï¼Œå½“ç”¨æˆ·ç‚¹å‡»æ£‹ç›˜çš„æ—¶å€™ï¼Œå¯èƒ½æ˜¯é€‰ä¸­æ£‹å­ï¼Œä¹Ÿå¯èƒ½æ˜¯ç§»åŠ¨æ£‹å­ï¼Œå¦‚ä¸‹å®ç°ï¼š</p>
<pre class="language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">process_click</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">,</span> pos<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token keyword">i32</span><span class="token punctuation">,</span> <span class="token keyword">i32</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token keyword">let</span> <span class="token class-name">Some</span><span class="token punctuation">(</span>dst<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">get_click_rect</span><span class="token punctuation">(</span>pos<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token function">get_chess_role</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>chesses<span class="token punctuation">[</span>dst<span class="token number">.0</span><span class="token punctuation">]</span><span class="token punctuation">[</span>dst<span class="token number">.1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">self</span><span class="token punctuation">.</span>role <span class="token punctuation">&#123;</span>
            <span class="token comment">// may be move</span>
            <span class="token keyword">if</span> <span class="token keyword">let</span> <span class="token class-name">Some</span><span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span>movable_pos<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token operator">&amp;&amp;</span>mv<span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">&#123;</span> <span class="token keyword">return</span> <span class="token function">get_dst_pos</span><span class="token punctuation">(</span>mv<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token function">to_pos</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>dst<span class="token punctuation">)</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">let</span> src <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span>selected_chess<span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">move_chess</span><span class="token punctuation">(</span><span class="token function">to_move</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token punctuation">(</span><span class="token function">get_pos</span><span class="token punctuation">(</span>src<span class="token punctuation">)</span><span class="token punctuation">,</span> dst<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
            <span class="token keyword">self</span><span class="token punctuation">.</span>selected_chess <span class="token operator">=</span> <span class="token class-name">None</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span> <span class="token comment">// must be selected, because role is same as chess</span>
            <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"selected_chess: &#123;:?&#125;"</span><span class="token punctuation">,</span> <span class="token function">to_pos</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>dst<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">self</span><span class="token punctuation">.</span>selected_chess <span class="token operator">=</span> <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token function">to_pos</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>dst<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token keyword">self</span><span class="token punctuation">.</span>movable_pos<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre>
<p>è¿™æ—¶å€™çœ‹åˆ°ç»“æ„ç»‘å®šçš„å¥½å¤„äº†ï¼Œ<code>get_click_rect</code>è¿”å›ä¸€ä¸ª <code>Option&lt;(usize, usize)&gt;</code> å€¼ï¼Œå°†ç”¨æˆ·çš„é¼ æ ‡ä½ç½®è½¬æ¢æˆæ£‹ç›˜çš„è¡Œåˆ—ä½ç½®ã€‚é€šè¿‡ <code>if let</code> è¯­å¥æ¥è·å¾— <code>Some</code> é‡Œé¢çš„å€¼å¹¶å–å‡ºï¼Œæ¥ç€è¿›è¡Œåˆ¤æ–­ã€‚è‹¥ç”¨æˆ·æ²¡æœ‰é€‰ä¸­æ£‹å­ï¼Œè¿™å¯èƒ½æ˜¯ç§»åŠ¨æ£‹å­ï¼Œè¿™æ—¶å€™é€šè¿‡æŸ¥æ‰¾ <code>movable_pos</code> æ¥åˆ¤æ–­æ˜¯å¦ç§»åŠ¨ã€‚</p>
<p>å†æ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼š</p>
<pre class="language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">for</span> event <span class="token keyword">in</span> <span class="token keyword">self</span><span class="token punctuation">.</span>event_pump<span class="token punctuation">.</span><span class="token function">poll_iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">match</span> event <span class="token punctuation">&#123;</span>
        <span class="token comment">// ...</span>
        <span class="token class-name">Event</span><span class="token punctuation">::</span><span class="token class-name">KeyDown</span> <span class="token punctuation">&#123;</span> keycode<span class="token punctuation">:</span> <span class="token class-name">Some</span><span class="token punctuation">(</span>keycode<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">..</span> <span class="token punctuation">&#125;</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">match</span> keycode <span class="token punctuation">&#123;</span>
                <span class="token class-name">Keycode</span><span class="token punctuation">::</span><span class="token class-name">Escape</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>       <span class="token punctuation">&#125;</span>
                <span class="token class-name">Keycode</span><span class="token punctuation">::</span><span class="token class-name">U</span>      <span class="token operator">=></span> <span class="token punctuation">&#123;</span> undo <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>
                _ <span class="token operator">=></span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token class-name">Event</span><span class="token punctuation">::</span><span class="token class-name">MouseButtonDown</span> <span class="token punctuation">&#123;</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> <span class="token punctuation">..</span><span class="token punctuation">&#125;</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span> click_pos <span class="token operator">=</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>
        _ <span class="token operator">=></span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre>
<p>ç»“æ„åŒ–ç»‘å®šï¼Œå¯ä»¥åˆ†åˆ«å–å‡ºç»“æ„ä½“ <code>Event::KeyDown</code>, <code>Event::MouseButtonDown</code> å¯¹è±¡é‡Œçš„æˆå‘˜å˜é‡ï¼š<code>keycode</code>, <code>x, y</code>ã€‚</p>
<p>é€šè¿‡ç»“æ„åŒ–ç»‘å®šï¼Œå†™èµ·æ¥å¾ˆçˆ½ã€‚ç›®å‰ C++ 17 ä¹Ÿæœ‰äº†ç»“æ„åŒ–ç»‘å®šï¼Œä½†æ˜¯æ²¡æœ‰ Rust é‚£ä¹ˆå¼ºå¤§ã€‚å¯¹äº <code>Option</code> è¿™ä¸ªè¡¨è¾¾å¯æœ‰çš„æ¦‚å¿µï¼ŒC++17 ä¹Ÿæœ‰äº†<code>std::optional</code>ã€‚</p>
<h2 id="match è¡¨è¾¾å¼">match è¡¨è¾¾å¼</h2>
<p>Rust è¿˜æœ‰ä¸€ä¸ªå¼ºå¤§çš„è¯­å¥ï¼Œé‚£å°±æ˜¯<code>match</code>ï¼Œå‰é¢ä¾‹å­å·²ç»ä»‹ç»è¿‡äº†ï¼Œå†™èµ·æ¥æ˜¯è¿™æ ·çš„ã€‚åˆ¤æ–­æ£‹å­æ˜¯å¦è¿›å…¥äº†å¯¹æ–¹çš„å…½ç©´ï¼š</p>
<pre class="language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">check_in_den</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">,</span> pos<span class="token punctuation">:</span> <span class="token constant">POS</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">bool</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">let</span> pos_ <span class="token operator">=</span> <span class="token function">get_pos</span><span class="token punctuation">(</span>pos<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">match</span> <span class="token punctuation">(</span><span class="token function">get_chess_role</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>chesses<span class="token punctuation">[</span>pos_<span class="token number">.0</span><span class="token punctuation">]</span><span class="token punctuation">[</span>pos_<span class="token number">.1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> pos<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token punctuation">(</span><span class="token constant">RED</span><span class="token punctuation">,</span> <span class="token constant">BLACK_DEN</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span><span class="token constant">BLACK</span><span class="token punctuation">,</span> <span class="token constant">RED_DEN</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        _ <span class="token operator">=></span> <span class="token punctuation">&#123;</span> <span class="token keyword">return</span> <span class="token boolean">false</span> <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre>
<p>å…¶ä¸­ <code>(RED, BLACK_DEN) | (BLACK, RED_DEN) =&gt; return true</code> è¯­ä¹‰å¾ˆæ¸…æ™°ï¼Œå¦‚æœçº¢è‰²æ£‹å­è¿›äº†é»‘è‰²å…½ç©´ï¼Œæˆ–è€…é»‘è‰²æ£‹å­è¿›äº†çº¢è‰²å…½ç©´ï¼Œåˆ™ä¸ºçœŸï¼›å…¶ä»–æƒ…å†µä¸ºå‡ã€‚å¦‚æœæ¢æˆ <code>if-else</code> è¯­å¥ï¼Œå†™å‡ºæ¥å°±å¾ˆä¸‘äº†ã€‚</p>
<p>è¿˜æœ‰ <code>check_movable</code> é‡Œçš„åˆ¤æ–­åƒå­ä»£ç ä¹Ÿå¾ˆç®€æ´ï¼š</p>
<pre class="language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">match</span> <span class="token punctuation">(</span>src_chess_type<span class="token punctuation">,</span> dst_chess_type<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token punctuation">(</span><span class="token constant">RAT</span><span class="token punctuation">,</span> <span class="token constant">ELEPHANT</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token operator">!</span> <span class="token keyword">Self</span><span class="token punctuation">::</span><span class="token function">check_in_water</span><span class="token punctuation">(</span>src<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token constant">ELEPHANT</span><span class="token punctuation">,</span> <span class="token constant">RAT</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span>s<span class="token punctuation">,</span> d<span class="token punctuation">)</span>          <span class="token operator">=></span> s <span class="token operator">&lt;=</span> d <span class="token operator">||</span> <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">check_in_traps</span><span class="token punctuation">(</span>dst<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span></code></pre>
<ul>
<li>è€é¼ è‹¥ä¸åœ¨æ°´é‡Œåˆ™èƒ½å¤Ÿåƒå¤§è±¡ï¼š<code>(RAT, ELEPHANT) =&gt; ! Self::check_in_water(src)</code></li>
<li>å¤§è±¡åœ¨ä»»ä½•æƒ…å†µä¸‹éƒ½ä¸èƒ½åƒè€é¼ ï¼š<code>(ELEPHANT, RAT) =&gt; false</code></li>
<li>å…¶ä»–åœºæ™¯æŒ‰ç…§å¤§å­åƒå°å­è§„åˆ™ï¼Œè‹¥å¯¹æ–¹åœ¨é™·é˜±é‡Œï¼Œæ— è§†è¿™ä¸ªè§„åˆ™ï¼š<code>(s, d)          =&gt; s &lt;= d || self.check_in_traps(dst)</code></li>
</ul>
<p>å†æ¥çœ‹çœ‹ä¸€ä¸ªä¾‹å­ï¼Œå°±æ˜¯æ ¹æ® fen ä¸²æ¥åˆå§‹åŒ–æ£‹ç›˜ã€‚fen ä¸²æ˜¯ç”¨å­—ç¬¦ä¸²è®°å½•äº†æ£‹å­åœ¨æ£‹ç›˜ä¸­çš„ä½ç½®ï¼Œä¾‹å¦‚åˆå§‹åŒ–çš„ fen ä¸²æ˜¯è¿™æ ·çš„ï¼š<code>l5t/1d3c1/r1p1w1e/7/7/7/E1W1P1R/1C3D1/T5L</code>ï¼Œå°å†™è¡¨ç¤ºé»‘æ–¹ï¼Œå¤§å†™è¡¨ç¤ºçº¢æ–¹ã€‚ä¸€ä¸ªå­—æ¯è¡¨ç¤ºä¸€ä¸ªæ£‹å­ï¼Œå¦‚æœæ²¡æœ‰æ£‹å­ï¼Œåˆ™ç”¨æ•°å­—è¡¨ç¤ºå‡ºç›¸é‚»è¿ç»­çš„ç©ºä½æ•°ã€‚æ–—å…½æ£‹å…±æœ‰ä¹è¡Œï¼Œæ¯è¡Œéƒ½ç”¨ä¸€ä¸ªå­—ç¬¦ä¸²è¡¨ç¤ºï¼Œè¡Œé—´ä½¿ç”¨æ­£æ–œæ åˆ†å‰²ã€‚</p>
<p>è§£æ <code>fen</code> ä¸²çš„ä»£ç æ˜¯è¿™æ ·çš„ï¼Œå¾ˆæ¸…çˆ½ï¼š</p>
<pre class="language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">load_fen</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">,</span> fen<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">let</span> fen_u8 <span class="token operator">=</span> fen<span class="token punctuation">.</span><span class="token function">as_bytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> <span class="token keyword">mut</span> fen_idx <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> get_role <span class="token operator">=</span> <span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>c<span class="token punctuation">:</span> <span class="token keyword">u8</span><span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">-></span> <span class="token class-name">Role</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>c <span class="token keyword">as</span> <span class="token keyword">char</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">is_lowercase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token constant">BLACK</span> <span class="token punctuation">&#125;</span>
        <span class="token keyword">else</span> <span class="token punctuation">&#123;</span> <span class="token constant">RED</span> <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> <span class="token keyword">mut</span> pos <span class="token operator">=</span> <span class="token number">0usize</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span> fen_idx <span class="token operator">&lt;</span> fen_u8<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">let</span> <span class="token keyword">mut</span> chess_id <span class="token operator">=</span> <span class="token constant">EMPTY</span><span class="token punctuation">;</span>
        <span class="token keyword">match</span> fen_u8<span class="token punctuation">[</span>fen_idx<span class="token punctuation">]</span> <span class="token punctuation">&#123;</span>
            c <span class="token operator">@</span> <span class="token char string">b'e'</span> <span class="token operator">|</span> c <span class="token operator">@</span> <span class="token char string">b'E'</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span> chess_id <span class="token operator">=</span> <span class="token function">get_chess_id</span><span class="token punctuation">(</span><span class="token function">get_role</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token constant">ELEPHANT</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>
            c <span class="token operator">@</span> <span class="token char string">b'l'</span> <span class="token operator">|</span> c <span class="token operator">@</span> <span class="token char string">b'L'</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span> chess_id <span class="token operator">=</span> <span class="token function">get_chess_id</span><span class="token punctuation">(</span><span class="token function">get_role</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token constant">LION</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token punctuation">&#125;</span>
            c <span class="token operator">@</span> <span class="token char string">b't'</span> <span class="token operator">|</span> c <span class="token operator">@</span> <span class="token char string">b'T'</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span> chess_id <span class="token operator">=</span> <span class="token function">get_chess_id</span><span class="token punctuation">(</span><span class="token function">get_role</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token constant">TIGER</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>
            c <span class="token operator">@</span> <span class="token char string">b'p'</span> <span class="token operator">|</span> c <span class="token operator">@</span> <span class="token char string">b'P'</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span> chess_id <span class="token operator">=</span> <span class="token function">get_chess_id</span><span class="token punctuation">(</span><span class="token function">get_role</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token constant">PANTHER</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>
            c <span class="token operator">@</span> <span class="token char string">b'w'</span> <span class="token operator">|</span> c <span class="token operator">@</span> <span class="token char string">b'W'</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span> chess_id <span class="token operator">=</span> <span class="token function">get_chess_id</span><span class="token punctuation">(</span><span class="token function">get_role</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token constant">WOLF</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token punctuation">&#125;</span>
            c <span class="token operator">@</span> <span class="token char string">b'd'</span> <span class="token operator">|</span> c <span class="token operator">@</span> <span class="token char string">b'D'</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span> chess_id <span class="token operator">=</span> <span class="token function">get_chess_id</span><span class="token punctuation">(</span><span class="token function">get_role</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token constant">DOG</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span>
            c <span class="token operator">@</span> <span class="token char string">b'c'</span> <span class="token operator">|</span> c <span class="token operator">@</span> <span class="token char string">b'C'</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span> chess_id <span class="token operator">=</span> <span class="token function">get_chess_id</span><span class="token punctuation">(</span><span class="token function">get_role</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token constant">CAT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span>
            c <span class="token operator">@</span> <span class="token char string">b'r'</span> <span class="token operator">|</span> c <span class="token operator">@</span> <span class="token char string">b'R'</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span> chess_id <span class="token operator">=</span> <span class="token function">get_chess_id</span><span class="token punctuation">(</span><span class="token function">get_role</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token constant">RAT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span>
            n <span class="token operator">@</span> <span class="token char string">b'1'</span> <span class="token punctuation">..=</span> <span class="token char string">b'9'</span>   <span class="token operator">=></span> <span class="token punctuation">&#123;</span> pos <span class="token operator">+=</span> <span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token char string">b'0'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token keyword">usize</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>
            <span class="token char string">b'/'</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span> <span class="token punctuation">&#125;</span>
            <span class="token char string">b''</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>
            _    <span class="token operator">=></span> <span class="token punctuation">&#123;</span> <span class="token macro property">unreachable!</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token keyword">if</span> chess_id <span class="token operator">!=</span> <span class="token constant">EMPTY</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">self</span><span class="token punctuation">.</span>chesses<span class="token punctuation">[</span>pos <span class="token operator">/</span> <span class="token constant">COL_NUM</span><span class="token punctuation">]</span><span class="token punctuation">[</span>pos <span class="token operator">%</span> <span class="token constant">COL_NUM</span><span class="token punctuation">]</span> <span class="token operator">=</span> chess_id<span class="token punctuation">;</span>
            pos <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        fen_idx <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    fen_idx <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// eat ' '</span>
    <span class="token keyword">self</span><span class="token punctuation">.</span>role <span class="token operator">=</span> <span class="token keyword">if</span> fen_u8<span class="token punctuation">[</span>fen_idx<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token char string">b'w'</span> <span class="token punctuation">&#123;</span> <span class="token constant">RED</span> <span class="token punctuation">&#125;</span>
                <span class="token keyword">else</span> <span class="token punctuation">&#123;</span> <span class="token constant">BLACK</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token punctuation">&#125;</span></code></pre>
<p><code>c @ b'e' | c @ b'E' =&gt; &#123; chess_id = get_chess_id(get_role(c), ELEPHANT); &#125;</code>è¿™å¥è¡¨è¾¾äº†è‹¥ä¸º <code>e</code> æˆ–è€…<code>E</code>ï¼Œåˆ™é€šè¿‡é¢œè‰²æ¥å¾—åˆ°å¯¹åº”çš„æ£‹å­ idã€‚å¯æƒœ Rust ç›®å‰è¿˜ä¸æ”¯æŒè¿™ç§å†™æ³•ï¼š<code>c @ (b'e' | b'E')</code>ï¼Œç›®å‰ or-patterns syntax is experimentalï¼Œæš‚æ—¶è¿™ä¹ˆå†™äº†ã€‚</p>
<h2 id="lambda è¡¨è¾¾å¼">lambda è¡¨è¾¾å¼</h2>
<pre class="language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">let</span> get_role <span class="token operator">=</span> <span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>c<span class="token punctuation">:</span> <span class="token keyword">u8</span><span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">-></span> <span class="token class-name">Role</span> <span class="token punctuation">&#123;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>c <span class="token keyword">as</span> <span class="token keyword">char</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">is_lowercase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token constant">BLACK</span> <span class="token punctuation">&#125;</span>
	<span class="token keyword">else</span> <span class="token punctuation">&#123;</span> <span class="token constant">RED</span> <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span></code></pre>
<p>ç”¨ <code>lambda</code> è¡¨è¾¾å¼å°è£… <code>get_role</code> æ¥é€šè¿‡å­—ç¬¦å¤§å°å†™åˆ¤æ–­çº¢é»‘è‰²ï¼Œé¿å…é‡å¤ä»£ç ï¼Œå› ä¸ºè¿™ä¸ªå‡½æ•°åªæœ‰å†…éƒ¨ä½¿ç”¨ï¼Œæ²¡å¿…è¦å°è£…æˆä¸€ä¸ªå•ç‹¬å‡½æ•°ã€‚</p>
<h2 id="è¿­ä»£å™¨">è¿­ä»£å™¨</h2>
<p>Rust çš„è¿­ä»£å™¨ä¹Ÿå¾ˆçˆ½ï¼Œç›®å‰ C++ 20 çš„ <code>std::views</code> ä¹Ÿç®€åŒ–äº†è¿™ç§æ“ä½œï¼Œçœ‹çœ‹ä¾‹å­ã€‚</p>
<p>æ¥çœ‹çœ‹åŸºæœ¬èµ°æ³•çš„ç”Ÿæˆï¼Œä¹Ÿå°±æ˜¯åªèƒ½èµ°åå­—ï¼Œæ¯æ¬¡åªèƒ½èµ°ä¸€æ ¼ï¼Œè€é¼ å¯ä»¥è¿›æ²³ã€‚</p>
<pre class="language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">generate_basic_steps</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">,</span> src<span class="token punctuation">:</span> <span class="token constant">POS</span><span class="token punctuation">,</span> to_water<span class="token punctuation">:</span> <span class="token keyword">bool</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token constant">MOVE</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> <span class="token constant">DX</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token keyword">i32</span><span class="token punctuation">;</span> <span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token constant">DY</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token keyword">i32</span><span class="token punctuation">;</span> <span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> src_ <span class="token operator">=</span> <span class="token function">get_pos</span><span class="token punctuation">(</span>src<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span>src_<span class="token number">.0</span> <span class="token keyword">as</span> <span class="token keyword">i32</span><span class="token punctuation">,</span> src_<span class="token number">.1</span> <span class="token keyword">as</span> <span class="token keyword">i32</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">..</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">into_iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>idx<span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">&#123;</span>
        <span class="token function">to_move</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token punctuation">(</span><span class="token function">get_pos</span><span class="token punctuation">(</span>src<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>x <span class="token operator">+</span> <span class="token constant">DX</span><span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token keyword">usize</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>y <span class="token operator">+</span> <span class="token constant">DY</span><span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token keyword">usize</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token operator">&amp;</span>mv<span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">let</span> <span class="token punctuation">(</span>_<span class="token punctuation">,</span> dst<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">get_move</span><span class="token punctuation">(</span>mv<span class="token punctuation">)</span><span class="token punctuation">;</span>
        dst<span class="token number">.0</span> <span class="token operator">&lt;</span> <span class="token constant">ROW_NUM</span> <span class="token operator">&amp;&amp;</span> dst<span class="token number">.1</span> <span class="token operator">&lt;</span> <span class="token constant">COL_NUM</span> <span class="token operator">&amp;&amp;</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">check_movable</span><span class="token punctuation">(</span>src<span class="token punctuation">,</span> <span class="token function">get_dst_pos</span><span class="token punctuation">(</span>mv<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
        <span class="token punctuation">(</span><span class="token operator">!</span> <span class="token keyword">Self</span><span class="token punctuation">::</span><span class="token function">check_in_water</span><span class="token punctuation">(</span><span class="token function">to_pos</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>dst<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">||</span> to_water<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span></code></pre>
<p><code>(0..4).into_iter()</code>ç”Ÿæˆ <code>[0,4)</code> çš„ rangeï¼Œç„¶ååŸºäº range åšè®¡ç®—ã€‚</p>
<p>é€šè¿‡ <code>idx</code> å¾—åˆ°å››ä¸ªæ–¹å‘çš„åæ ‡ï¼Œç”Ÿæˆ (src, dst) ç§»åŠ¨å‘é‡ã€‚</p>
<pre class="language-rust" data-language="rust"><code class="language-rust"><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>idx<span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">&#123;</span>
    <span class="token function">to_move</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token punctuation">(</span><span class="token function">get_pos</span><span class="token punctuation">(</span>src<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>x <span class="token operator">+</span> <span class="token constant">DX</span><span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token keyword">usize</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>y <span class="token operator">+</span> <span class="token constant">DY</span><span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token keyword">usize</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span></code></pre>
<p>è¿‡æ»¤å››ä¸ªæ–¹å‘ï¼Œåªæœ‰åœ¨èŒƒå›´å†…ã€å¯ä»¥åƒæ‰å¯¹æ–¹ã€èƒ½è¿‡æ²³çš„ç»“æœä¿ç•™ä¸‹æ¥ï¼š</p>
<pre class="language-rust" data-language="rust"><code class="language-rust"><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token operator">&amp;</span>mv<span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">let</span> <span class="token punctuation">(</span>_<span class="token punctuation">,</span> dst<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">get_move</span><span class="token punctuation">(</span>mv<span class="token punctuation">)</span><span class="token punctuation">;</span>
    dst<span class="token number">.0</span> <span class="token operator">&lt;</span> <span class="token constant">ROW_NUM</span> <span class="token operator">&amp;&amp;</span> dst<span class="token number">.1</span> <span class="token operator">&lt;</span> <span class="token constant">COL_NUM</span> <span class="token operator">&amp;&amp;</span>
    <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">check_movable</span><span class="token punctuation">(</span>src<span class="token punctuation">,</span> <span class="token function">get_dst_pos</span><span class="token punctuation">(</span>mv<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
    <span class="token punctuation">(</span><span class="token operator">!</span> <span class="token keyword">Self</span><span class="token punctuation">::</span><span class="token function">check_in_water</span><span class="token punctuation">(</span><span class="token function">to_pos</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>dst<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">||</span> to_water<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span></code></pre>
<p>æ¥ä¸‹æ¥æ˜¯ç‹®å­ã€è€è™çš„èµ°æ³•ç”Ÿæˆï¼š</p>
<pre class="language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">generate_tl_steps</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">,</span> src<span class="token punctuation">:</span> <span class="token constant">POS</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token constant">MOVE</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">let</span> <span class="token keyword">mut</span> basic_steps <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">generate_basic_steps</span><span class="token punctuation">(</span>src<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> src_ <span class="token operator">=</span> <span class="token function">get_pos</span><span class="token punctuation">(</span>src<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token keyword">Self</span><span class="token punctuation">::</span><span class="token function">check_at_bank</span><span class="token punctuation">(</span>src<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// [2, 6]</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>src_<span class="token number">.0</span> <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">4</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">&#123;</span>
            basic_steps<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token function">to_move</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token punctuation">(</span>src_<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>src_<span class="token number">.0</span> <span class="token operator">+</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">8</span><span class="token punctuation">,</span> src_<span class="token number">.1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">if</span> src_<span class="token number">.1</span> <span class="token operator">%</span> <span class="token number">6</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">&#123;</span>
                basic_steps<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token function">to_move</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token punctuation">(</span>src_<span class="token punctuation">,</span> <span class="token punctuation">(</span>src_<span class="token number">.0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
                basic_steps<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token function">to_move</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token punctuation">(</span>src_<span class="token punctuation">,</span> <span class="token punctuation">(</span>src_<span class="token number">.0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                basic_steps<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token function">to_move</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token punctuation">(</span>src_<span class="token punctuation">,</span> <span class="token punctuation">(</span>src_<span class="token number">.0</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>

        basic_steps <span class="token operator">=</span> basic_steps<span class="token punctuation">.</span><span class="token function">into_iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token operator">&amp;</span>mv<span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">let</span> <span class="token punctuation">(</span>src<span class="token punctuation">,</span> dst<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token function">get_src_pos</span><span class="token punctuation">(</span>mv<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">get_dst_pos</span><span class="token punctuation">(</span>mv<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">check_movable</span><span class="token punctuation">(</span>src<span class="token punctuation">,</span> dst<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">check_rat</span><span class="token punctuation">(</span>src<span class="token punctuation">,</span> dst<span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
    basic_steps
<span class="token punctuation">&#125;</span></code></pre>
<p>é¦–å…ˆå¾—åˆ°åŸºæœ¬èµ°æ³•ï¼Œç„¶åç”Ÿæˆè·³æ²³èµ°æ³•ã€‚æœ€åçš„ <code>filter</code> è¿‡æ»¤æ— æ•ˆçš„ç§»åŠ¨ï¼Œä¾‹å¦‚ç‹®å­è€è™è·³æ²³çš„æ—¶å€™ä¸­é—´ä¸èƒ½æœ‰è€é¼ ï¼Œå¯¹å²¸çš„æ£‹å­æ¯”è‡ªå·±å°æ—¶ã€‚</p>
<pre class="language-rust" data-language="rust"><code class="language-rust">basic_steps<span class="token punctuation">.</span><span class="token function">into_iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token operator">&amp;</span>mv<span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">let</span> <span class="token punctuation">(</span>src<span class="token punctuation">,</span> dst<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token function">get_src_pos</span><span class="token punctuation">(</span>mv<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">get_dst_pos</span><span class="token punctuation">(</span>mv<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">check_movable</span><span class="token punctuation">(</span>src<span class="token punctuation">,</span> dst<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">check_rat</span><span class="token punctuation">(</span>src<span class="token punctuation">,</span> dst<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
<p>é€šè¿‡è¿­ä»£å™¨çš„ <code>map</code> å¯ä»¥åšç±»å‹è½¬æ¢ï¼Œä»è€Œä¼ å‚ç»™æŒ‡å®šç±»å‹çš„æ¥å£ã€‚ä¾‹å¦‚ <code>fn draw_frame(&amp;mut self, tgt_pos: &amp;Vec&lt;POS&gt;)</code> æ¥å£ï¼Œéœ€è¦çš„å‚æ•°ç±»å‹ä¸º<code>Vec&lt;POS&gt;</code>ï¼Œå¯å®é™…å‚æ•°æ˜¯<code>Vec&lt;MOVE&gt;</code>ï¼Œé€šè¿‡å¦‚ä¸‹è½¬æ¢ï¼š</p>
<pre class="language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">process_selected_chess</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token keyword">let</span> <span class="token class-name">Some</span><span class="token punctuation">(</span>pos<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span>selected_chess <span class="token punctuation">&#123;</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">draw_frame</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token macro property">vec!</span><span class="token punctuation">[</span>pos<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

        <span class="token keyword">self</span><span class="token punctuation">.</span>movable_pos <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">generate_steps</span><span class="token punctuation">(</span>pos<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">draw_frame</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">.</span>movable_pos<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token operator">&amp;</span>mv<span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">&#123;</span> <span class="token function">get_dst_pos</span><span class="token punctuation">(</span>mv<span class="token punctuation">)</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span></code></pre>
<p>è¿™ä¸ªæ¥å£ç»˜åˆ¶é€‰ä¸­çš„æ£‹å­ã€ä»¥åŠå¯ç§»åŠ¨çš„æ ¼å­çš„æ¡†æ¡†ï¼Œ<code>self.movable_pos.iter().map(|&amp;mv| &#123; get_dst_pos(mv) &#125;).collect()</code>è¿›è¡Œç±»å‹è½¬æ¢ï¼Œåªä¿ç•™ <code>dst</code> çš„åæ ‡ã€‚</p>
<h2 id="Borrow-Checker">Borrow Checker</h2>
<p>Rust é€šè¿‡å€Ÿç”¨æ£€æŸ¥æ¥é¿å…å†™å‡ºä¸å®‰å…¨çš„ä»£ç ï¼š</p>
<ul>
<li>ç¬¬ä¸€ï¼Œä»»ä½•å€Ÿç”¨å¿…é¡»ä½äºæ¯”æ‹¥æœ‰è€…æ›´å°çš„ä½œç”¨åŸŸ</li>
<li>ç¬¬äºŒï¼Œå¯¹äºåŒä¸€ä¸ªèµ„æºï¼ˆresourceï¼‰çš„å€Ÿç”¨ï¼Œå³åŒä¸€ä¸ªä½œç”¨åŸŸä¸‹ï¼Œè¦ä¹ˆåªæœ‰ä¸€ä¸ªå¯¹èµ„æº A çš„å¯å˜å¼•ç”¨ï¼ˆ<code>&amp;mut T</code>ï¼‰ï¼Œè¦ä¹ˆæœ‰ N ä¸ªä¸å¯å˜å¼•ç”¨ï¼ˆ<code>&amp;T</code>ï¼‰ï¼Œä½†ä¸èƒ½åŒæ—¶å­˜åœ¨å¯å˜å’Œä¸å¯å˜çš„å¼•ç”¨</li>
</ul>
<p>æ‰€ä»¥å¦‚ä¸‹ä»£ç ï¼š</p>
<pre class="language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">let</span> <span class="token keyword">mut</span> undo <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> event <span class="token keyword">in</span> <span class="token keyword">self</span><span class="token punctuation">.</span>event_pump<span class="token punctuation">.</span><span class="token function">poll_iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">match</span> event <span class="token punctuation">&#123;</span>
        <span class="token comment">// ...</span>
        <span class="token class-name">Event</span><span class="token punctuation">::</span><span class="token class-name">KeyDown</span> <span class="token punctuation">&#123;</span> keycode<span class="token punctuation">:</span> <span class="token class-name">Some</span><span class="token punctuation">(</span>keycode<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">..</span> <span class="token punctuation">&#125;</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">match</span> keycode <span class="token punctuation">&#123;</span>
                <span class="token class-name">Keycode</span><span class="token punctuation">::</span><span class="token class-name">U</span>      <span class="token operator">=></span> <span class="token punctuation">&#123;</span> undo <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>
                _ <span class="token operator">=></span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
        _ <span class="token operator">=></span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">if</span> undo <span class="token punctuation">&#123;</span>
    <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">undo_move</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token keyword">self</span><span class="token punctuation">.</span>compture_turn <span class="token punctuation">&#123;</span> <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">undo_move</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre>
<p>ä¸èƒ½ç›´æ¥å†™æˆï¼š</p>
<pre class="language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">for</span> event <span class="token keyword">in</span> <span class="token keyword">self</span><span class="token punctuation">.</span>event_pump<span class="token punctuation">.</span><span class="token function">poll_iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">match</span> event <span class="token punctuation">&#123;</span>
        <span class="token comment">// ...</span>
        <span class="token class-name">Event</span><span class="token punctuation">::</span><span class="token class-name">KeyDown</span> <span class="token punctuation">&#123;</span> keycode<span class="token punctuation">:</span> <span class="token class-name">Some</span><span class="token punctuation">(</span>keycode<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">..</span> <span class="token punctuation">&#125;</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">match</span> keycode <span class="token punctuation">&#123;</span>
                <span class="token class-name">Keycode</span><span class="token punctuation">::</span><span class="token class-name">U</span>      <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
                    <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">undo_move</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">if</span> <span class="token keyword">self</span><span class="token punctuation">.</span>compture_turn <span class="token punctuation">&#123;</span> <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">undo_move</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>
                <span class="token punctuation">&#125;</span>
                _ <span class="token operator">=></span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
        _ <span class="token operator">=></span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre>
<p>å› ä¸º <code>self.event_pump.poll_iter()</code> æ‹¿åˆ°äº† <code>&amp;mut self</code>ï¼Œè€Œ<code>self.undo_move()</code> ä¹Ÿæ‹¿åˆ°äº†<code>&amp;mut self</code>ï¼Œè¿™åœ¨ Rust æ˜¯ç»å¯¹ä¸å…è®¸çš„ã€‚</p>
<pre class="language-none"><code class="language-none">error[E0499]: cannot borrow &#96;*self&#96; as mutable more than once at a time
   --&gt; src&#x2F;game.rs:440:33
    |
433 |             for event in self.event_pump.poll_iter() &#123;
    |                          ---------------------------
    |                          |
    |                          first mutable borrow occurs here
    |                          first borrow later used here
...
440 |                                 self.undo_move();
    |                                 ^^^^ second mutable borrow occurs here

error[E0499]: cannot borrow &#96;*self&#96; as mutable more than once at a time
   --&gt; src&#x2F;game.rs:441:57
    |
433 |             for event in self.event_pump.poll_iter() &#123;
    |                          ---------------------------
    |                          |
    |                          first mutable borrow occurs here
    |                          first borrow later used here
...
441 |                                 if self.compture_turn &#123; self.undo_move(); &#125;
    |                                                         ^^^^ second mutable borrow occurs here</code></pre>
<h2 id="å®">å®</h2>
<p>å®ä½œä¸ºä¸€ç§é¢„å¤„ç†é˜¶æ®µå­—ç¬¦æ›¿æ¢æœºåˆ¶ï¼Œå¯ä»¥æ¶ˆé™¤ä¸€äº›é‡å¤ä»£ç ï¼Œæ¯”å¦‚åŠ è½½èµ„æºæ–‡ä»¶ï¼Œå¯ä»¥é€šè¿‡å®šä¹‰ç®€å•çš„ <code>macro_rules!</code> æ¥å¤ç”¨ä»£ç ï¼š</p>
<pre class="language-rust" data-language="rust"><code class="language-rust"><span class="token macro property">macro_rules!</span> load_asset_file <span class="token punctuation">&#123;</span>
    <span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">:</span> literal<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span> <span class="token macro property">include_bytes!</span><span class="token punctuation">(</span><span class="token macro property">concat!</span><span class="token punctuation">(</span><span class="token macro property">env!</span><span class="token punctuation">(</span><span class="token string">"CARGO_MANIFEST_DIR"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"/../assets/"</span><span class="token punctuation">,</span> <span class="token variable">$name</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">let</span> <span class="token keyword">mut</span> game <span class="token operator">=</span> <span class="token class-name">Game</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// ...</span>
    board_texture<span class="token punctuation">:</span> texture_creator
        <span class="token punctuation">.</span><span class="token function">load_texture_bytes</span><span class="token punctuation">(</span><span class="token macro property">load_asset_file!</span><span class="token punctuation">(</span><span class="token string">"board.png"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">expect</span><span class="token punctuation">(</span><span class="token string">"board.png"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    selected_frame<span class="token punctuation">:</span> texture_creator
        <span class="token punctuation">.</span><span class="token function">load_texture_bytes</span><span class="token punctuation">(</span><span class="token macro property">load_asset_file!</span><span class="token punctuation">(</span><span class="token string">"oos.gif"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">expect</span><span class="token punctuation">(</span><span class="token string">"oos.gif"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span></code></pre>
<h2 id="Trait">Trait</h2>
<p>Trait åœ¨ Rust ç”¨äºè¡¨è¾¾æ¥å£çº¦æŸçš„æ¦‚å¿µï¼Œæ—¢æ”¯æŒé™æ€å¤šæ€ï¼Œä¹Ÿæ”¯æŒåŠ¨æ€å¤šæ€ dyn traitï¼Œå’Œ Haskell çš„ typeclass ç±»ä¼¼ã€‚</p>
<p>å­˜åœ¨çš„é—®é¢˜æ˜¯ä¸çŸ¥é“ä¸€ä¸ª struct å¯¹è±¡å®ç°äº†å‡ ä¸ª Trait æ¥å£ï¼Œåªèƒ½é€šè¿‡ç”Ÿæˆçš„æ–‡æ¡£æŸ¥çœ‹ï¼Œå¼±åŒ–ç‰ˆæ¥å£äº†ã€‚</p>
<p>è¿™é‡Œå¯ä»¥æŠ½è±¡å‡ºä¸€ä¸ª Player çš„ Traitï¼Œç±»ä¼¼äºç­–ç•¥æ¨¡å¼ï¼Œå®ç°ä¸åŒçš„ AI ç­–ç•¥ã€‚ç›®å‰å®ç°äº† Alpha-Beta å‰ªæå’Œè’™ç‰¹å¡ç½—æœç´¢æ ‘ä¸¤ç§ç®—æ³•ï¼š</p>
<pre class="language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">pub</span> <span class="token keyword">trait</span> <span class="token class-name">Player</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">get_move</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token constant">MOVE</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">impl</span> <span class="token class-name">Player</span> <span class="token keyword">for</span> <span class="token class-name">AlphaBeta</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">get_move</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token constant">MOVE</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">search_main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">impl</span> <span class="token class-name">Player</span> <span class="token keyword">for</span> <span class="token class-name">MCTSPlayer</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">get_move</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token constant">MOVE</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">mcts_run</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre>
<h2 id="æµ‹è¯•">æµ‹è¯•</h2>
<p>Rust ç¼–è¯‘å™¨é›†æˆäº†æµ‹è¯•æ¨¡å—ï¼Œä¸ä¾èµ–åº“çš„æƒ…å†µä¸‹ç¼–å†™è‡ªæµ‹è¯•ç”¨ä¾‹ï¼Œé€šè¿‡ <code>assert_eq!</code> ç­‰æ–­è¨€ï¼š</p>
<pre class="language-rust" data-language="rust"><code class="language-rust"><span class="token attribute attr-name">#[cfg(test)]</span>
<span class="token keyword">mod</span> <span class="token module-declaration namespace">tests</span> <span class="token punctuation">&#123;</span>
<span class="token attribute attr-name">#[test]</span>
<span class="token keyword">fn</span> <span class="token function-definition function">test_zobrist</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">use</span> <span class="token keyword">crate</span><span class="token module-declaration namespace"><span class="token punctuation">::</span>board<span class="token punctuation">::</span></span><span class="token punctuation">&#123;</span><span class="token class-name">Board</span><span class="token punctuation">,</span> to_move<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> <span class="token keyword">mut</span> board <span class="token operator">=</span> <span class="token class-name">Board</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    board<span class="token punctuation">.</span><span class="token function">load_fen</span><span class="token punctuation">(</span><span class="token string">"lL5/7/7/7/7/7/7/7/7 w"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> zobrist_key <span class="token operator">=</span> board<span class="token punctuation">.</span>zobrist_key<span class="token punctuation">;</span>
    <span class="token keyword">let</span> src <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> dst <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    board<span class="token punctuation">.</span><span class="token function">move_chess</span><span class="token punctuation">(</span><span class="token function">to_move</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token punctuation">(</span>src<span class="token punctuation">,</span> dst<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    board<span class="token punctuation">.</span><span class="token function">move_chess</span><span class="token punctuation">(</span><span class="token function">to_move</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token punctuation">(</span>dst<span class="token punctuation">,</span> src<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">assert_eq!</span><span class="token punctuation">(</span>zobrist_key<span class="token punctuation">,</span> board<span class="token punctuation">.</span>zobrist_key<span class="token punctuation">)</span><span class="token punctuation">;</span>

    board<span class="token punctuation">.</span><span class="token function">undo_move</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    board<span class="token punctuation">.</span><span class="token function">undo_move</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token macro property">assert_eq!</span><span class="token punctuation">(</span>zobrist_key<span class="token punctuation">,</span> board<span class="token punctuation">.</span>zobrist_key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    board<span class="token punctuation">.</span><span class="token function">move_chess</span><span class="token punctuation">(</span><span class="token function">to_move</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token punctuation">(</span>src<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    board<span class="token punctuation">.</span><span class="token function">undo_move</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">assert_eq!</span><span class="token punctuation">(</span>zobrist_key<span class="token punctuation">,</span> board<span class="token punctuation">.</span>zobrist_key<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre>
<p>é€šè¿‡ <code>cargo test</code> æ‰§è¡Œæµ‹è¯•ç”¨ä¾‹ã€‚</p>
<h2 id="åæ§½">åæ§½</h2>
<p>å¼€å‘è¿‡ç¨‹è¿˜æ˜¯å¾ˆçˆ½çš„ï¼Œä½†æ˜¯ä¹Ÿæœ‰ä¸€äº›å°é—®é¢˜ï¼Œè®°å½•åœ¨è¿™ã€‚</p>
<p><code>cargo publish</code>å‘å¸ƒåŒ…çš„æ—¶å€™ï¼Œæ²¡è€ƒè™‘ <code>assets</code> çš„æƒ…å†µï¼Œæ‰€ä»¥ <code>cargo install</code> åå›¾ç‰‡èµ„æºæ²¡æ³•å®šä½ï¼Œç›®å‰æ²¡ä»€ä¹ˆå¥½çš„æ–¹æ¡ˆï¼Œæ‰€ä»¥æœ€å¥½é€šè¿‡ä¸‹è½½æºä»£ç  <code>cargo run</code> çš„å½¢å¼æ¥è¿è¡Œã€‚</p>
<p>ç›¸å¯¹ C++ æ¥è¯´æ ‡å‡†åº“ä¸å¤Ÿå®Œå–„ï¼Œå¾ˆå¤šåŸºæœ¬æ¥å£éƒ½æ²¡æœ‰ï¼Œä¾‹å¦‚ <code>std::collections::LinkedList</code> è¿æ’åºæ¥å£éƒ½æ²¡æœ‰ï¼Œå¯¼è‡´åªèƒ½ä½¿ç”¨ <code>Vec</code> è¿™ç§ç®€å•çš„æ•°æ®ç±»å‹ã€‚ä¼°è®¡æ˜¯é¼“åŠ±ç”¨ç¬¬ä¸‰æ–¹åº“å§ï¼Œæ¯•ç«Ÿ Rust å¯¹åŒ…ä¾èµ–å¤„ç†åœ°å¾ˆå¥½ã€‚</p>
<p>Borrow Checker æœºåˆ¶æœ‰æ—¶å€™å¤ªå‚»äº†ï¼Œæœ‰æ—¶å€™å¾—äº¤æ¢ä»£ç è¡Œæ‰èƒ½ç¼–è¯‘é€šè¿‡ã€‚</p>
<p>å…³äºå†…å­˜å®‰å…¨æ€§ï¼Œä¾‹å¦‚å¼€å‘è¿‡ç¨‹ä¸­æ•°ç»„è¶Šç•Œè®¿é—®äº†ï¼Œä¼šå¯¼è‡´ <code>panic</code> ç„¶åæŒ‚æ‰ï¼Œè¿™åº”è¯¥æ˜¯æœ€å¥½ç»“æœã€‚å¦‚æœæ˜¯ C è¯­è¨€çš„è¯ï¼Œæ•°ç»„è¶Šç•Œè®¿é—®æ˜¯ä¸ä¼šç›´æ¥æŒ‚æ‰ï¼Œè¿™å°±ç•™ä¸‹äº†éšæ‚£è®©åˆ«æœ‰ç”¨å¿ƒçš„äººåˆ©ç”¨äº†ã€‚</p>
<h2 id="åç»­">åç»­</h2>
<p>åæ¥è¡¥å……äº† AlphaGo ç®—æ³•å®ç°ï¼Œåˆ©ç”¨ pymodule æ¨¡å—ç»™ Python å†™æ‰©å±•ï¼Œç„¶åç”¨ <code>pytorch</code> åº“è¿›è¡Œå¼ºåŒ–å­¦ä¹ è®­ç»ƒï¼Œè®­ç»ƒäº†ä¸¤å‘¨æ²¡è§æ•ˆæœï¼Œæ”¾å¼ƒäº†ã€‚</p>
<p>é€šè¿‡è¿™ä¸ªé¡¹ç›®ä¹Ÿè®¤è¯†åˆ°äº†å°è£…çš„é‡è¦æ€§ï¼Œå“ªæ€•å†å°çš„æ•°æ®ç»“æ„ï¼Œå°è£…ä¹Ÿæœ‰åˆ©äºç»´æŠ¤ä¸æ¼”è¿›ã€‚ä¾‹å¦‚æœ€åˆçš„åæ ‡æ˜¯ <code>(usize, usize)</code>ï¼Œç§»åŠ¨å‘é‡æ˜¯<code>((usize, usize), (usize, usize))</code>ï¼Œé€šè¿‡ç±»å‹åˆ«å<code>POS</code> å’Œ<code>MOVE</code>ï¼Œåæ¥åˆ†åˆ«å‹ç¼©æˆ <code>u8</code> å’Œ<code>u16</code>ï¼Œé‡æ„åä¹Ÿæ²¡å‡ºç°è¿‡é—®é¢˜ã€‚å°è£…ä¹Ÿæ˜¯ä¸€ç§æŠ½è±¡ï¼Œä¾èµ–æŠ½è±¡å³èƒ½ä¿è¯æˆ‘ä»¬ä»£ç ä¸å®¹æ˜“å—ç ´åã€‚</p>
<p>æ€»çš„æ¥è¯´ç”¨ Rust å†™èµ·æ¥å¾ˆèˆ’æœï¼Œç»“åˆäº†å¾ˆå¤šè¯­è¨€çš„ä¼˜ç‚¹ï¼Œä»è€Œæœ‰è¶³å¤Ÿçš„è¡¨è¾¾åŠ›ï¼ŒæœŸå¾…ä»Šåå‘å±•ä¼šè¶Šæ¥è¶Šå¥½å§ã€‚</p>

    
  </div>

</article>


   
       <div class="original">
    <ul>
        <li>æœ¬æ–‡æ ‡é¢˜ï¼šç”¨ Rust å†™ä¸€ä¸ªæ–—å…½æ£‹æ¸¸æˆ</li>
        <li>æœ¬æ–‡å­—æ•°ï¼š4k</li>
        <li>æœ¬æ–‡ä½œè€…ï¼šNetcan</li>
        <li>å‘å¸ƒæ—¶é—´ï¼š2020å¹´06æœˆ07æ—¥ - 10æ—¶56åˆ†</li>
        <li>æœ€åæ›´æ–°ï¼š2022å¹´12æœˆ09æ—¥ - 19æ—¶02åˆ†</li>
        <li>åŸå§‹é“¾æ¥ï¼š<a href="https://netcan.github.io/2020/06/07/%E7%94%A8Rust%E5%86%99%E4%B8%80%E4%B8%AA%E6%96%97%E5%85%BD%E6%A3%8B%E6%B8%B8%E6%88%8F/">https://netcan.github.io/2020/06/07/ç”¨Rustå†™ä¸€ä¸ªæ–—å…½æ£‹æ¸¸æˆ/</a></li>
        <li>ç‰ˆæƒå£°æ˜ï¼š<i class="icon icon-cc"></i><a href="http://creativecommons.org/licenses/by-nc-sa/3.0/cn/" title="ä¸­å›½å¤§é™† (CC BY-NC-SA 3.0 CN)" rel="external nofollow noopener noreferrer" target="_blank">"ç½²å-éå•†ç”¨-ç›¸åŒæ–¹å¼å…±äº« 3.0"</a>è½¬è½½è¯·ä¿ç•™åŸæ–‡é“¾æ¥åŠä½œè€…ã€‚</li>
    </ul>
</div>

   

   
  <div class="text-center donation">
    <div class="inner-donation">
      <span class="btn-donation">æ”¯æŒä¸€ä¸‹</span>
      <div class="donation-body">
        <div class="tip text-center">æ‰«ä¸€æ‰«ï¼Œæ”¯æŒNetcan</div>
        <ul>
        
          <li class="item">
            
              <span>å¾®ä¿¡æ‰«ä¸€æ‰«</span>
            
            <img src="/images/qr-wechat.png" alt="">
          </li>
        
          <li class="item">
            
              <span>æ”¯ä»˜å®æ‰«ä¸€æ‰«</span>
            
            <img src="/images/qr-alipay.png" alt="">
          </li>
        
        </ul>
      </div>
    </div>
  </div>


   
  <div class="box-prev-next clearfix">
    <a class="show pull-left" href="/2020/05/30/%E6%9E%84%E9%80%A0%E3%80%81%E6%9E%90%E6%9E%84%E6%9C%9F%E9%97%B4%E8%A2%AB%E8%B0%83%E8%99%9A%E5%87%BD%E6%95%B0%E5%8F%91%E7%94%9F%E7%9A%84%E6%83%A8%E6%A1%88/">
        <i class="icon icon-angle-left"></i>
    </a>
    <a class="show pull-right" href="/2020/08/01/%E5%A6%82%E4%BD%95%E4%BC%98%E9%9B%85%E7%9A%84%E5%AE%9E%E7%8E%B0C-%E7%BC%96%E8%AF%91%E6%9C%9F%E9%9D%99%E6%80%81%E5%8F%8D%E5%B0%84/">
        <i class="icon icon-angle-right"></i>
    </a>
  </div>




</div>


  <a id="backTop" class="back-top">
    <i class="icon-angle-up"></i>
  </a>



<script src="https://cdn.jsdelivr.net/npm/jquery@3.6.3/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@4.0/dist/fancybox.umd.js"></script>
<script>
    $(".article-content img").wrap(function() {
        return '<a data-fancybox href="' + $(this).attr("src") + '"/>';
    });
</script>


  <div class="modal" id="modal">
  <span id="cover" class="cover hide"></span>
  <div id="modal-dialog" class="modal-dialog hide-dialog">
    <div class="modal-header">
      <span id="close" class="btn-close">å…³é—­</span>
    </div>
    <hr>
    <div class="modal-body">
      <ul class="list-toolbox">
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/archives/"
              rel="noopener noreferrer"
              target="_self"
              >
              åšå®¢
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/category/"
              rel="noopener noreferrer"
              target="_self"
              >
              åˆ†ç±»
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/tag/"
              rel="noopener noreferrer"
              target="_self"
              >
              æ ‡ç­¾
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/about/"
              rel="noopener noreferrer"
              target="_self"
              >
              å…³äº
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/atom.xml"
              rel="noopener noreferrer"
              target="_blank"
              >
              RSS
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/search/"
              rel="noopener noreferrer"
              target="_self"
              >
              æœç´¢
            </a>
          </li>
        
      </ul>

    </div>
  </div>
</div>



  
      <div class="fexo-comments comments-post">
    

    

    
    

    

    
    

    

<!-- Gitalkè¯„è®ºæ’ä»¶é€šç”¨ä»£ç  -->
<div id="gitalk-container"></div>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
<script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
<script src="//cdn.bootcss.com/blueimp-md5/2.10.0/js/md5.js"></script>
<script>
const gitalk = new Gitalk({
  clientID: '893a4103795fc66cd8e7',
  clientSecret: '35c92c3dca938831b67dc22e46d64bc9073ebacf',
  repo: 'netcan.github.io',
  owner: 'Netcan',
  // åœ¨è¿™é‡Œè®¾ç½®ä¸€ä¸‹æˆªå–å‰50ä¸ªå­—ç¬¦ä¸², è¿™æ˜¯å› ä¸º github å¯¹ label çš„é•¿åº¦æœ‰äº†è¦æ±‚, å¦‚æœè¶…è¿‡
  // 50ä¸ªå­—ç¬¦ä¸²åˆ™ä¼šæŠ¥é”™.
  // id: location.pathname.split('/').pop().substring(0, 49),
  id: md5(location.pathname),
  admin: ['Netcan'],
  // facebook-like distraction free mode
  distractionFreeMode: false
})
gitalk.render('gitalk-container')
</script>
<!-- Gitalkä»£ç ç»“æŸ -->



  </div>

  

  <script type="text/javascript">
  function loadScript(url, callback) {
    var script = document.createElement('script')
    script.type = 'text/javascript';

    if (script.readyState) { //IE
      script.onreadystatechange = function() {
        if (script.readyState == 'loaded' ||
          script.readyState == 'complete') {
          script.onreadystatechange = null;
          callback();
        }
      };
    } else { //Others
      script.onload = function() {
        callback();
      };
    }

    script.src = url;
    document.getElementsByTagName('head')[0].appendChild(script);
  }

  window.onload = function() {
    loadScript('/js/bundle.js?235683', function() {
      // load success
    });
  }
</script><!-- hexo-inject:begin --><!-- hexo-inject:end -->

</body>
</html>
